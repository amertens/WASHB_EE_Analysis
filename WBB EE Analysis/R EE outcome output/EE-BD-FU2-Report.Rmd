---
title: "EE BD FU2 report"
author: "Andrew Mertens"
date: "August 12, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.width=12, fig.height=20)
```

```{r, include=FALSE}
rm(list=ls())
library(tidyverse)
library(knitr)
load("C:/Users/andre/Dropbox/WASHB-EE-analysis/WBB-EE-analysis/Results/Andrew/FU2_results.Rdata")


#Plot parameters
scaleFUN <- function(x) sprintf("%.2f", x)

#Plot themes
theme_set(theme_bw())

#hbgdki pallet
tableau10 <- c("#1F77B4","#FF7F0E","#2CA02C","#D62728",
  "#9467BD","#8C564B","#E377C2","#7F7F7F","#BCBD22","#17BECF")

```


# N's by treatment arm

```{r, echo=F}
knitr::kable(summary_res)
```

# Plots of WASH Benefits intervention effects, stratified by FU2 status (FU2 as an effect modifier)

Note: stars above the plotted points indicate that the P-value of the interaction term between treatment and FU2 status is < 0.05.

Columns are sampling round, and rows are EED outcomes.

### Child FU2 status

```{r, echo=F}
print(C_plot_EM)
```


### Maternal FU2 status

```{r, echo=F}
print(M_plot_EM)
```


# Plots of associations between FU2 status and EED outcomes (FU2 as a risk factor)

### Child FU2 status

```{r, echo=F, fig.width=12, fig.height=8}
plotdf <-data.frame(X= rownames(res_childFU2_RF_adj), res_childFU2_RF_adj)
plotdf$outcome <- substr(plotdf$X, 1,2)
ggplot(plotdf, aes(x=X)) + 
        geom_point(aes(y=ATE, fill=outcome, color=outcome), size = 4) +
        geom_linerange(aes(ymin=ci.l, ymax=ci.u, color=outcome),
                       alpha=0.5, size = 3) +
        labs(x = "EED outcome", y = "Average treatment effect on log-transformed outcome") +
        geom_hline(yintercept = 0) +
        scale_fill_manual(values=rep(tableau10,4)) +
        scale_colour_manual(values=rep(tableau10,4)) +
        theme(strip.background = element_blank(),
          legend.position="none",
          strip.text.x = element_text(size=12),
          axis.text.x = element_text(size=12, angle = 45, hjust = 1)) +
        ggtitle("Child FU2 status effect on EED outcomes")
```
### Maternal FU2 status

```{r, echo=F, fig.width=12, fig.height=8}
plotdf <-data.frame(X= rownames(res_motherFU2_RF_adj), res_motherFU2_RF_adj)
plotdf$outcome <- substr(plotdf$X, 1,2)
ggplot(plotdf, aes(x=X)) + 
        geom_point(aes(y=ATE, fill=outcome, color=outcome), size = 4) +
        geom_linerange(aes(ymin=ci.l, ymax=ci.u, color=outcome),
                       alpha=0.5, size = 3) +
        labs(x = "EED outcome", y = "Average treatment effect on log-transformed outcome") +
        geom_hline(yintercept = 0) +
        scale_fill_manual(values=rep(tableau10,4)) +
        scale_colour_manual(values=rep(tableau10,4)) +
        theme(strip.background = element_blank(),
          legend.position="none",
          strip.text.x = element_text(size=12),
          axis.text.x = element_text(size=12, angle = 45, hjust = 1)) +
        ggtitle("Mother's FU2 status effect on EED outcomes")
```
     



# Plots of associations between FU2 status and growth outcomes (FU2 as a risk factor)

### Child FU2 status -continious outcomes

```{r, echo=F, fig.width=12, fig.height=8}
plotdf <-data.frame(X= rownames(res_childFU2_growthRF_cont), res_childFU2_growthRF_cont)
plotdf$outcome <- substr(plotdf$X, 1,3)
ggplot(plotdf, aes(x=X)) + 
        geom_point(aes(y=ATE, fill=outcome, color=outcome), size = 4) +
        geom_linerange(aes(ymin=ci.l, ymax=ci.u, color=outcome),
                       alpha=0.5, size = 3) +
        labs(x = "Continious growth outcome", y = "Average treatment effect") +
        geom_hline(yintercept = 0) +
        scale_fill_manual(values=rep(tableau10,4)) +
        scale_colour_manual(values=rep(tableau10,4)) +
        theme(strip.background = element_blank(),
          legend.position="none",
          strip.text.x = element_text(size=12),
          axis.text.x = element_text(size=12, angle = 45, hjust = 1)) +
        ggtitle("Child FU2 status effect on continious growth outcomes")
```

### Child FU2 status -binary outcomes

```{r, echo=F, fig.width=12, fig.height=8}
plotdf <-data.frame(X= rownames(res_childFU2_growthRF_bin), res_childFU2_growthRF_bin)
plotdf$RR[plotdf$X=="swast1"] <- NA #Temp drop extreme estimates
plotdf$ci.l[plotdf$X=="swast1"] <- NA
plotdf$ci.u[plotdf$X=="swast1"] <- NA

plotdf$outcome <- substr(plotdf$X, 1,3)
ggplot(plotdf, aes(x=X)) + 
        geom_point(aes(y=RR, fill=outcome, color=outcome), size = 4) +
        geom_linerange(aes(ymin=ci.l, ymax=ci.u, color=outcome),
                       alpha=0.5, size = 3) +
        labs(x = "Binary growth outcome", y = "Average treatment effect") +
  scale_y_continuous(trans='log10') +
        geom_hline(yintercept = 1) +
        scale_fill_manual(values=rep(tableau10,4)) +
        scale_colour_manual(values=rep(tableau10,4)) +
        theme(strip.background = element_blank(),
          legend.position="none",
          strip.text.x = element_text(size=12),
          axis.text.x = element_text(size=12, angle = 45, hjust = 1)) +
        ggtitle("Child FU2 status effect on binary growth outcomes")
```

### Maternal FU2 status -continious outcomes

```{r, echo=F, fig.width=12, fig.height=8}
plotdf <-data.frame(X= rownames(res_motherFU2_growthRF_cont), res_motherFU2_growthRF_cont)
plotdf$outcome <- substr(plotdf$X, 1,3)
ggplot(plotdf, aes(x=X)) + 
        geom_point(aes(y=ATE, fill=outcome, color=outcome), size = 4) +
        geom_linerange(aes(ymin=ci.l, ymax=ci.u, color=outcome),
                       alpha=0.5, size = 3) +
        labs(x = "Continious growth outcome", y = "Average treatment effect") +
        geom_hline(yintercept = 0) +
        scale_fill_manual(values=rep(tableau10,4)) +
        scale_colour_manual(values=rep(tableau10,4)) +
        theme(strip.background = element_blank(),
          legend.position="none",
          strip.text.x = element_text(size=12),
          axis.text.x = element_text(size=12, angle = 45, hjust = 1)) +
        ggtitle("Mother FU2 status effect on continious growth outcomes")
```

### Maternal FU2 status -binary outcomes

```{r, echo=F, fig.width=12, fig.height=8}
plotdf <-data.frame(X= rownames(res_motherFU2_growthRF_bin), res_motherFU2_growthRF_bin)
plotdf$outcome <- substr(plotdf$X, 1,3)
ggplot(plotdf, aes(x=X)) + 
        geom_point(aes(y=RR, fill=outcome, color=outcome), size = 4) +
        geom_linerange(aes(ymin=ci.l, ymax=ci.u, color=outcome),
                       alpha=0.5, size = 3) +
        labs(x = "Binary growth outcome", y = "Average treatment effect") +
  scale_y_continuous(trans='log10') +
        geom_hline(yintercept = 1) +        scale_fill_manual(values=rep(tableau10,4)) +
        scale_colour_manual(values=rep(tableau10,4)) +
        theme(strip.background = element_blank(),
          legend.position="none",
          strip.text.x = element_text(size=12),
          axis.text.x = element_text(size=12, angle = 45, hjust = 1)) +
        ggtitle("Mother FU2 status effect on binary growth outcomes")
```





# Tables of associations between FU2 status and EED outcomes (FU2 as a risk factor)


### Child FU2 status

```{r, echo=F}

  knitr::kable(res_childFU2_RF_adj)
  cat("\n\n\n")
  

```

### Maternal FU2 status

```{r, echo=F}
  knitr::kable(res_motherFU2_RF_adj)
  cat("\n\n\n")

```



# Tables of associations between FU2 status and growth outcomes (FU2 as a risk factor)


### Child FU2 status - continous outcomes

```{r, echo=F}

  knitr::kable(res_childFU2_growthRF_cont)
  cat("\n\n\n")
  

```

### Child FU2 status - binary outcomes

```{r, echo=F}

  knitr::kable(res_childFU2_growthRF_bin)
  cat("\n\n\n")
  

```

### Maternal FU2 status - continous outcomes

```{r, echo=F}
  knitr::kable(res_motherFU2_growthRF_cont)
  cat("\n\n\n")

```

### Maternal FU2 status - binary outcomes

```{r, echo=F}
  knitr::kable(res_motherFU2_growthRF_bin)
  cat("\n\n\n")

```





# Tables of WASH Benefits intervention effects, stratified by FU2 status (FU2 as an effect modifier)


## Child FU2 status

```{r, echo=F, results='asis'}
for(i in 1:length(res_childFU2_EM_unadj)){
  
  cat("### Outcome: ",names(res_childFU2_EM_unadj)[i],"\n\n")
  print(knitr::kable(res_childFU2_EM_unadj[[i]]))
  
  cat("\n\n\n")
  
}
```

## Maternal FU2 status

```{r, echo=F, results='asis'}
for(i in 1:length(res_motherFU2_EM_unadj)){
  
  cat("### Outcome: ",names(res_motherFU2_EM_unadj)[i],"\n\n")
  print(knitr::kable(res_motherFU2_EM_unadj[[i]]))
  
  cat("\n\n\n")
  
}
```

 

